\documentclass{scrreprt}
\usepackage[shellescape]{gmp}
\usepackage{listings}
\usepackage{underscore}
\usepackage[bookmarks=true]{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{enumitem}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{fancyhdr}
\usepackage{tikz}
\usepackage{pgf-umlsd}

%%%%%% header and footer info
\pagestyle{fancy}
\fancyhf{}
\rhead{Software Requirements Specification}
\lhead{Training Montage}
\cfoot{\thepage}

%%%%%% custom list definition
\newlist{numonly}{enumerate}{10}
\setlist[numonly]{label*=\arabic*.}

\hypersetup{
    pdftitle={Software Requirement Specification},    % title
    pdfauthor={Training Montage},                     % author
    pdfsubject={TeX and LaTeX},                        % subject of the document
    pdfkeywords={TeX, LaTeX, graphics, images}, % list of keywords
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=blue,       % color of internal links
    citecolor=black,       % color of links to bibliography
    filecolor=black,        % color of file links
    urlcolor=purple,        % color of external links
    linktoc=page            % only page is linked
}

\begin{document}

\begin{flushright}
    \rule{16cm}{5pt}\vskip1cm
    \begin{bfseries}
        \Huge{TRACK MODEL USE CASE, CLASS, AND SEQUENCE DIAGRAMS}\\
        \vspace{.9cm}
        for\\
        \vspace{.9cm}
        COE 1186 Project\\
        \vspace{.9cm}
        % \LARGE{Version \myversion approved}\\
        \vspace{.9cm}
        Prepared by:\\
        Alec Rosenbaum\\
        \vspace{4.9cm}
        Training Montage\\
        \vspace{.9cm}
        \today\\
    \end{bfseries}
\end{flushright}

\tableofcontents

\chapter{Track Model}

\section{Use Cases}

\begin{center}
\resizebox{!}{.8\textheight}{
	\begin{mpost}
		input metauml;
		vardef drawComponentVisualStereotype(text ne)= relax enddef;
		Actor.ctc("CTC");
		Actor.wayside("Wayside");
		Actor.trainmodel("Train Model");
		Actor.traincontroller("Train Controller");
		Actor.simrunner("SimulationRunner");
	    % 
	    Usecase.uO("Get Passengers Departed");
	    Usecase.uA("Get Static Block");
	    Usecase.uB("Get Static Switch");
	    %
	    Usecase.uC("Get Occupancy");
		Usecase.uD("Set Suggested", "Speed");
		Usecase.uDD("Set Suggested", "Authority");
		Usecase.uE("Set Maintainance");
		Usecase.uF("Set Switch State");
		Usecase.uG("Set Signals");
		Usecase.uH("Set Railroad", "Crossing");
		Usecase.uI("Get Block State");
		Usecase.uJ("Get Signal");
		Usecase.uK("Get Crossing");
		%
		Usecase.uKK("Initalize TrackModel");
		%
		Usecase.uL("Initalize Train");
		Usecase.uM("Get Suggested", "Authority");
		Usecase.uN("Get Suggested", "Speed");
		Usecase.uP("Get Grade");
		Usecase.uQ("Get If Track", "Is Icy");
		Usecase.uR("Get Beacon Data");
		Usecase.uS("Teardown Train");
	    %
	    Component.TrackModel("Track Model")(uA,uB,uC,uD,uDD,uE,uF,uG,uH,uI,uJ,uK,uKK,uL,uM,uN,uO,uP,uQ,uR,uS);
	    % 
		topToBottom.left(10)(uO,uA,uB,uC,uD,uDD,uE,uF,uG,uH,uI,uJ,uK);
		leftToRight(50)(ctc, uA);
		leftToRight(50)(traincontroller, uD);
		leftToRight(50)(wayside, uG);
		%
		topToBottom.right(10)(uL,uM,uN,uP,uQ,uR,uS,uKK);
		leftToRight(100)(uC, uL);
		leftToRight(50)(uL, trainmodel);
		leftToRight(50)(uKK, simrunner);
	    % 
	    drawObjects(ctc,wayside,trainmodel,traincontroller,simrunner,TrackModel,uA,uB,uC,uD,uDD,uE,uF,uG,uH,uI,uJ,uK,uL,uM,uN,uO,uP,uQ,uR,uS);
		%
	    link(association)(pathCut(ctc, uA)(ctc.e -- uA.w));
	    link(association)(pathCut(ctc, uA)(ctc.e -- uB.w));
	    link(association)(pathCut(ctc, uO)(ctc.e -- uO.w));
	    %
	    link(association)(pathCut(traincontroller, uA)(traincontroller.e -- uA.w));
	    link(association)(pathCut(traincontroller, uA)(traincontroller.e -- uB.w));
	    %
	    link(association)(pathCut(wayside, uA)(wayside.e -- uA.w));
	    link(association)(pathCut(wayside, uB)(wayside.e -- uB.w));
	    link(association)(pathCut(wayside, uC)(wayside.e -- uC.w));
	    link(association)(pathCut(wayside, uD)(wayside.e -- uD.w));
	    link(association)(pathCut(wayside, uE)(wayside.e -- uE.w));
	    link(association)(pathCut(wayside, uF)(wayside.e -- uF.w));
	    link(association)(pathCut(wayside, uG)(wayside.e -- uG.w));
	    link(association)(pathCut(wayside, uH)(wayside.e -- uH.w));
	    link(association)(pathCut(wayside, uI)(wayside.e -- uI.w));
	    link(association)(pathCut(wayside, uJ)(wayside.e -- uJ.w));
	    link(association)(pathCut(wayside, uK)(wayside.e -- uK.w));
	    %
	    link(association)(pathCut(simrunner, uKK)(simrunner.w -- uKK.e));
	    %
	    link(association)(pathCut(trainmodel, uA)(trainmodel.w -- uA.e));
	    link(association)(pathCut(trainmodel, uB)(trainmodel.w -- uB.e));
	    link(association)(pathCut(trainmodel, uL)(trainmodel.w -- uL.e));
	    link(association)(pathCut(trainmodel, uM)(trainmodel.w -- uM.e));
	    link(association)(pathCut(trainmodel, uN)(trainmodel.w -- uN.e));
	    link(association)(pathCut(trainmodel, uP)(trainmodel.w -- uP.e));
	    link(association)(pathCut(trainmodel, uQ)(trainmodel.w -- uQ.e));
	    link(association)(pathCut(trainmodel, uR)(trainmodel.w -- uR.e));
	    link(association)(pathCut(trainmodel, uS)(trainmodel.w -- uS.e));
	\end{mpost}
}
\end{center}

\subsection{Use Case: Get Passengers Departed}
\begin{enumerate}
	\item CTC calls getPassengers(trainId)
	\item If train is at a station, number of passengers who left train is returned. Otherwise, 0 is returned.
\end{enumerate}

\subsection{Use Case: Get Static Block}
\begin{enumerate}
	\item User calls getStaticBlock(blockId)
	\item Instance of StaticBlock populated with static data is returned.
\end{enumerate}

\subsection{Use Case: Get Static Switch}
\begin{enumerate}
	\item User calls getStaticSwitch(switchId)
	\item Intstance of StaticSwitch populated with static data is returned.
\end{enumerate}

\subsection{Use Case: Get Occupancy}
\begin{enumerate}
	\item Wayside Actor calls isOccupied(blockId)
	\item True is returned if block is occupied, False if block is unoccupied.
\end{enumerate}

\subsection{Use Case: Set Suggested Speed}
\begin{enumerate}
	\item Wayside calls setSpeed(blockId, speed)
	\item Suggested speed is set for that block.
\end{enumerate}

\subsection{Use Case: Set Suggested Speed}
\begin{enumerate}
	\item Wayside calls setAuthority(blockId, authority)
	\item Authority is set for that block.
\end{enumerate}

\subsection{Use Case: Set Maintainance}
\begin{enumerate}
	\item Wayside calls setStatus(blockId, BlockStatus.MAINTAIN)
	\item The block status of blockId is set to be Maintainance.
\end{enumerate}

\subsection{Use Case: Set Switch State}
\begin{enumerate}
	\item Wayside calls setStatus(blockId, BlockStatus.MAINTAIN)
	\item The block status of blockId is set to be Maintainance.
\end{enumerate}

\subsection{Use Case: Set Signal}
\begin{enumerate}
	\item Wayside calls setSignal(blockId, signal)
	\item The signal on block blockId is set to <signal> (true for green, false for red).
\end{enumerate}

\subsection{Use Case: Get Signal}
\begin{enumerate}
	\item Wayside calls getSignal(blockId)
	\item The signal state on blockId is returned (true for green, false for red).
\end{enumerate}

\subsection{Use Case: Set Railroad Crossing}
\begin{enumerate}
	\item Wayside calls setCrossing(blockId, state)
	\item The state of the crossing is set to <state> (true for active, false for inactive).
\end{enumerate}

\subsection{Use Case: Get Crossing}
\begin{enumerate}
	\item Wayside calls getCrossing(blockId)
	\item The corssing status of blockId is returned (true for active, false for inactive).
\end{enumerate}

\subsection{Use Case: Get Block State}
\begin{enumerate}
	\item Wayside calls getStatus(blockId)
	\item The block status of blockId is returned (an option from enum BlockStatus).
\end{enumerate}

\subsection{Use Case: Initialize Train}
\begin{enumerate}
	\item Train Model calls initializeTrain(trainId, blockId)
	\item The train is placed on to the track.
\end{enumerate}

\subsection{Use Case: Teardown Train}
\begin{enumerate}
	\item Train Model calls teardownTrain(trainId)
	\item The train is removed from the track.
\end{enumerate}

\subsection{Use Case: Get Suggested Authority}
\begin{enumerate}
	\item Train Model calls getTrainAuthority(trainId)
	\item The track model determines the location of the train, and returns the authority.
\end{enumerate}

\subsection{Use Case: Get Suggested Speed}
\begin{enumerate}
	\item Train Model calls getTrainSpeed(trainId)
	\item The track model determines the location or the train, and returns the suggested speed.
\end{enumerate}

\subsection{Use Case: Get Grade}
\begin{enumerate}
	\item Train Model calls getGrade(trainId)
	\item The track model determines the location or the train, and returns the grade of that block.
\end{enumerate}

\subsection{Use Case: Get If Track is Icy}
\begin{enumerate}
	\item Train Model calls isTrackIcy(trainId)
	\item The track model determines the location or the train, and returns if the track is icy (true for icy, false otherwise).
\end{enumerate}

\subsection{Use Case: Get Beacon Data}
\begin{enumerate}
	\item Train Model calls getBeacon(trainId)
	\item The track model determines the location or the train, and returns the beacon data at that block if a beacon is present (null if no beacon is present).
\end{enumerate}

\subsection{Use Case: Initialize TrackModel}
\begin{enumerate}
	\item SimulationRunner calls init()
	\item The track model performs initialization tasks and returns the singleton TrackModel instance.
\end{enumerate}


\section{Class Diagram}

\begin{center}
\resizebox{!}{.9\textheight}{
	\begin{mpost}
		input metauml;
	    % Track Model
	    Class.TrackModel("TrackModel")()(
	    	"TrackModel init()",
	    	"int getTrainAuthority(int trainId)",
			"double getTrainSpeed(int trainId)",
			"boolean setSignal(int blockId, boolean value)",
			"boolean getSignal(int blockId)",
			"boolean setSwitch(int blockId, boolean value)",
			"boolean getSwitch(int blockId)",
			"boolean setAuthority(int blockId, boolean authority)",
			"int setSpeed(int blockId, int speed)",
			"boolean setCrossing(int blockId, boolean active)",
			"boolean getCrossing(int blockId)",
			"byte[] getTrainBeacon(int trainId)",
			"int getPassengers(int trainId)",
			"boolean isIcyTrack(int trainId)",
			"StaticBlock getStaticBlock(int blockId)",
			"double getGrade(int trainId)",
			"boolean isOccupied(int blockId)",
			"BlockStatus getStatus(int blockId)"
		);
		% Database
	    Class.Database("Database")()(
	    	"ResultSet execute(Statement)",
		);
		% Static Block
		Class.StaticBlock("StaticBlock")()(
			"-int setId(int id)",
			"int getId()",
			"-String setRegion(String region)",
			"String getRegion()",
			"-double setGrade(double grade)",
			"double getGrade()",
			"-double setElevation(double elevation)",
			"double getElevation()",
			"-double setLength(double length)",
			"double getLength()",
			"-String setStation(String station)",
			"String getStation()",
			"-StaticSwitch setStaticSwitch(StaticSwitch staticSwitch)"
		);
	    % StaticSwitch
	    Class.StaticSwitch("StaticSwitch")()(
			"StaticBlock getRoot()",
			"-StaticBlock setRoot(StaticBlock root)",
			"StaticBlock getInactiveLeaf()",
			"-StaticBlock setInactiveLeaf(StaticBlock inactiveLeaf)",
			"StaticBlock getActiveLeaf()",
			"-StaticBlock setActiveLeaf(StaticBlock activeLeaf)"
	    );
		% 	
		topToBottom(30)(TrackModel, Database, StaticBlock, StaticSwitch);
		% 
	    drawObjects(TrackModel, Database, StaticBlock, StaticSwitch);
		%
		% StaticSwitch -> StaticBlock 1..3 
	    link(compositionUni)(pathStepX(StaticBlock.e, StaticSwitch.e, 30));
	    item(iAssoc)("1")(obj.nw = StaticSwitch.e + (15,0));
	    item(iAssoc)("3")(obj.nw = StaticBlock.e + (5,-5));
	    % TrackModel -> StaticSwitch 1..*
	    link(compositionUni)(pathStepX(StaticSwitch.e + (0,-20), TrackModel.e, 55));
	    item(iAssoc)("*")(obj.nw = StaticSwitch.e + (15,-20));
	    item(iAssoc)("1")(obj.nw = TrackModel.e + (5,-5));
	    % TrackModel -> StaticBlock 1..*
	    link(compositionUni)(pathStepX(StaticBlock.w, TrackModel.w, -25));
	    item(iAssoc)("*")(obj.nw = StaticBlock.w + (-20,0));
	    item(iAssoc)("1")(obj.nw = TrackModel.w + (-20,0));
	    % TrackModel -> Database 1..1
	    link(associationUni)(pathStepX(Database.n, TrackModel.s, 0));
	    item(iAssoc)("1")(obj.ne = TrackModel.s + (-5,-10));
	    item(iAssoc)("1")(obj.ne = Database.n + (0,10));
	    % StaticBlock -> StaticSwitch 1..0-1
	    link(associationUni)(pathStepX(StaticBlock.w + (0, -20), StaticSwitch.w, -25));
	    item(iAssoc)("1")(obj.nw = StaticBlock.w + (-20,-20));
	    item(iAssoc)("0..1")(obj.nw = StaticSwitch.w + (-20,-5));
	\end{mpost}
}
\end{center}


\section{Sequence Diagrams}

% \begin{center}
% \resizebox{\textwidth}{!}{
%  	\begin{sequencediagram}
% 	\newthread{sim}{Caller}
% 	\newinst[4]{tm}{TrackModel}
% 	\newinst[2]{sb}{StaticBlock}
% 	\newinst{ss}{StaticSwitch}
	
% 	\begin{sdblock}{Initialization}{Before Using the API}
% 		\begin{call}{sim}{Init()}{tm}{}
% 		\end{call}
% 	\end{sdblock}
% 	\begin{call}{sim}{TrackModel.getStaticBlock(id)}{tm}{}
% 		\begin{call}{tm}{StaticBlock()}{sb}{}
% 		\end{call}
% 		\begin{sdblock}{If A Switch is Attached}{}
% 			\begin{call}{tm}{StaticSwitch()}{ss}{}
% 			\end{call}
% 		\end{sdblock}
% 	\end{call}
% 	\end{sequencediagram}
% }
% \end{center}

\subsection{Sequence Diargam: Get Passengers Departed}
\begin{center}
\resizebox{\textwidth}{!}{
 	\begin{sequencediagram}
	\newthread{ctc}{CTC}
	\newinst[4]{tm}{TrackModel}
	\newinst[2]{db}{Database}
	
	\begin{call}{ctc}{getPassengers(trainId)}{tm}{}
		\begin{call}{tm}{execute(statement)}{db}{}
		\end{call}
	\end{call}
	\end{sequencediagram}
}
\end{center}

\subsection{Sequence Diargam: Get Static Block}
\begin{center}
\resizebox{\textwidth}{!}{
 	\begin{sequencediagram}
	\newthread{sim}{Caller}
	\newinst[3]{tm}{TrackModel}
	\newinst[2]{db}{Database}
	\newinst{sb}{StaticBlock}
	\newinst{ss}{StaticSwitch}
	
	\begin{call}{sim}{getStaticBlock(id)}{tm}{}
		\begin{call}{tm}{execute(statement)}{db}{}
		\end{call}
		\begin{call}{tm}{StaticBlock()}{sb}{}
		\end{call}
		\begin{sdblock}{If A Switch is Attached}{}
			\begin{call}{tm}{StaticSwitch()}{ss}{}
			\end{call}
		\end{sdblock}
	\end{call}
	\end{sequencediagram}
}
\end{center}

\subsection{Sequence Diargam: Get Static Switch}
\begin{center}
\resizebox{\textwidth}{!}{
 	\begin{sequencediagram}
	\newthread{sim}{Caller}
	\newinst[5]{tm}{TrackModel}
	\newinst[2]{ss}{StaticSwitch}
	
	\begin{call}{sim}{getStaticSwitch(id)}{tm}{}
		\begin{call}{tm}{StaticSwitch()}{ss}{}
		\end{call}
		\begin{sdblock}{For Root, Default, Active}{}
			\begin{call}{ss}{getStaticBlock(id)}{tm}{}
			\end{call}
		\end{sdblock}
	\end{call}
	\end{sequencediagram}
}
\end{center}

\subsection{Sequence Diargam: Get Occupancy}

\subsection{Sequence Diargam: Set Suggested Speed}

\subsection{Sequence Diargam: Set Suggested Speed}

\subsection{Sequence Diargam: Set Maintainance}

\subsection{Sequence Diargam: Set Switch State}

\subsection{Sequence Diargam: Set Signal}

\subsection{Sequence Diargam: Get Signal}

\subsection{Sequence Diargam: Set Railroad Crossing}

\subsection{Sequence Diargam: Get Crossing}

\subsection{Sequence Diargam: Get Block State}

\subsection{Sequence Diargam: Initialize Train}

\subsection{Sequence Diargam: Teardown Train}

\subsection{Sequence Diargam: Get Suggested Authority}

\subsection{Sequence Diargam: Get Suggested Speed}

\subsection{Sequence Diargam: Get Grade}

\subsection{Sequence Diargam: Get If Track is Icy}

\subsection{Sequence Diargam: Get Beacon Data}

\end{document}